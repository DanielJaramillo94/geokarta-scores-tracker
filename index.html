<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>danijara.dev</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React (UMD builds) -->
    <script
      src="https://unpkg.com/react@18/umd/react.production.min.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
      crossorigin
    ></script>
  </head>

  <body
    class="m-0 h-screen w-screen overflow-hidden bg-black text-white font-sans"
  >
    <div id="root"></div>

    <script src="./menu.js"></script>
    <script src="./stats-card.js"></script>

    <script>
      const { createElement: h, useEffect, useState } = React;
      const { createRoot } = ReactDOM;

      function App() {
        const [menuData, setMenuData] = useState(null);
        const [selectedKey, setSelectedKey] = useState(null);
        const [error, setError] = useState(null);

        // Fetch menu.json once on mount
        useEffect(() => {
          fetch("./menu.json")
            .then((res) => {
              if (!res.ok) {
                throw new Error("Failed to load menu.json");
              }
              return res.json();
            })
            .then((data) => {
              setMenuData(data);
              // Select first item by default
              const firstKey = Object.keys(data)[0];
              setSelectedKey(firstKey);
            })
            .catch((err) => {
              setError(err.message);
            });
        }, []);

        // Loading state
        if (!menuData) {
          return h(
            "div",
            {
              className:
                "h-screen flex items-center justify-center text-white/60",
            },
            error ? error : "Loadingâ€¦"
          );
        }

        return h(
          "div",
          { className: "h-screen grid grid-cols-[280px_1fr]" },

          h(window.DateSidebarMenu, {
            title: "Menu",
            dates: Object.keys(menuData),
            selectedDate: selectedKey,
            onSelect: setSelectedKey,
          }),

          h(
            "main",
            {
              className:
                "h-screen flex flex-col items-center justify-center p-6",
            },
            h("img", {
              src: "./assets/geokarta.png",
              alt: "Distance",
              className: "h-48 w-48 object-contain",
              loading: "lazy",
            }),
            h(window.StatsCard, {
              rank: "1",
              name: "Daniel",
              date: "17/12/2025",
              distance: "42,62 km",
              time: "01:28:82",
            }),
            h(window.StatsCard, {
              rank: "2",
              name: "Daniel",
              date: "17/12/2025",
              distance: "42,62 km",
              time: "01:28:82",
            }),
            h(window.StatsCard, {
              rank: "3",
              name: "Daniel",
              date: "17/12/2025",
              distance: "42,62 km",
              time: "01:28:82",
            })
          ),

          // Footer
          h(
            "div",
            {
              className:
                "fixed bottom-5 right-6 text-sm tracking-wide text-white/60 pointer-events-none",
            },
            "danijara.dev"
          )
        );
      }

      createRoot(document.getElementById("root")).render(h(App));
    </script>
  </body>
</html>
