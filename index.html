<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>danijara.dev</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IM+Fell+English&display=swap"
      rel="stylesheet"
    />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React (UMD builds) -->
    <script
      src="https://unpkg.com/react@18/umd/react.production.min.js"
      crossorigin
    ></script>
    <script
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
      crossorigin
    ></script>
  </head>

  <body
    class="m-0 h-screen w-screen overflow-hidden bg-[#11161fff] text-white font-sans"
    style="font-family: 'IM Fell English', serif"
  >
    <div id="root"></div>

    <script src="./menu.js"></script>
    <script src="./stats-card.js"></script>
    <script src="./stats-list.js"></script>

    <script>
      const { createElement: h, useEffect, useState } = React;
      const { createRoot } = ReactDOM;

      function App() {
        const [menuData, setMenuData] = useState(null);
        const [selectedKey, setSelectedKey] = useState(null);
        const [error, setError] = useState(null);
        const [menuOpen, setMenuOpen] = useState(false);

        useEffect(() => {
          fetch("./menu.json")
            .then((res) => {
              if (!res.ok) {
                throw new Error("Failed to load menu.json");
              }
              return res.json();
            })
            .then((data) => {
              setMenuData(data);
              const firstKey = Object.keys(data)[0];
              setSelectedKey(firstKey);
            })
            .catch((err) => {
              setError(err.message);
            });
        }, []);

        if (!menuData) {
          return h(
            "div",
            {
              className:
                "h-screen flex items-center justify-center text-white/60",
            },
            error ? error : "Loading…"
          );
        }

        const items = menuData[selectedKey] ?? [];
        const isEmpty = items.length === 0;

        return h(
          "div",
          { className: "h-screen grid grid-cols-1 md:grid-cols-[280px_1fr]" },

          menuOpen &&
            h(
              "div",
              {
                className: "fixed inset-0 z-40 bg-[#11161fff] md:hidden",
              },

              h(
                "button",
                {
                  type: "button",
                  className:
                    "absolute top-4 right-4 text-3xl leading-none text-white/80",
                  "aria-label": "Close menu",
                  onClick: () => setMenuOpen(false),
                },
                "✕"
              ),

              h(window.DateSidebarMenu, {
                title: "Fecha",
                dates: Object.keys(menuData),
                selectedDate: selectedKey,
                onSelect: (key) => {
                  setSelectedKey(key);
                  setMenuOpen(false);
                },
              })
            ),

          h(
            "div",
            { className: "hidden md:block" },
            h(window.DateSidebarMenu, {
              title: "Fecha",
              dates: Object.keys(menuData),
              selectedDate: selectedKey,
              onSelect: setSelectedKey,
            })
          ),

          !menuOpen &&
            h(
              "button",
              {
                type: "button",
                className:
                  "md:hidden fixed top-4 left-4 z-50 p-2 text-4xl rounded-lg bg-white/5 border border-white/10 text-white/80 hover:bg-white/10",
                "aria-label": "Open menu",
                onClick: () => setMenuOpen(true),
              },
              "☰"
            ),

          h(
            "main",
            {
              className:
                "h-screen flex flex-col items-center justify-center p-6 gap-8",
            },

            isEmpty
              ? h(
                  React.Fragment,
                  null,
                  h("img", {
                    src: "./assets/geokarta.png",
                    alt: "Geokarta",
                    className: "h-[60vh] w-[60vh] object-contain",
                    loading: "lazy",
                  })
                )
              : h(
                  React.Fragment,
                  null,

                  // Normal image
                  h("img", {
                    src: "./assets/geo-earth.png",
                    alt: "Geokarta",
                    className: "h-48 w-48 object-contain",
                    loading: "lazy",
                  }),

                  // Stats list
                  h(window.StatsList, {
                    items,
                  })
                )
          ),

          // Footer
          h(
            "div",
            {
              className:
                "fixed bottom-5 right-6 text-sm tracking-wide text-white/60 pointer-events-none",
            },
            "danijara.dev"
          )
        );
      }

      createRoot(document.getElementById("root")).render(h(App));
    </script>
  </body>
</html>
